参考：Operating System/计算机如何启动的

## 1.1 如何将编译好的程序提交给处理器

每种操作系统都对它所管理的程序提出了种种格式上的要求。比如，它要求编译好的程序必须在文件的开始部分包含编译日期，是针对哪种操作系统编译的，程序的版本，第一条指令从哪里开始，数据段从哪里开始、有多长，代码段从哪里开始、有多长，等等。

## 1.2 计算机的加电和复位

在处理器的引脚中，有一个是RESET，用于接受复位信号。每当处理器加电，或者RESET引脚的电平由低变高时，处理器都会执行一个硬件初始化，以及一个**可选的内部自测试**（Build-in Self-Test，BIST），然后将内部所有寄存器的内容初始到一个预置的状态。

对于 Intel 8086 来说，**复位将使代码段寄存器（CS）的内容为0xFFFF**，**其他**所有寄存器的内容都为**0x0000**，包括指令指针寄存器（IP）。8086之后的处理器**并未延续**这种设计。

处理器主要功能是取指和执行，加电或复位后，会理解尝试这么做。不过这时，内存中没有有意义的指令和数据，处理器怎么办？

先看下内存的特点。

在内存中，**每个比特的存储**都是靠一个极其微小的晶体管，外加一个同样极其微小的电容来完成的。可以想象，这样微小的电容，其泄漏电荷的速度当然也非常快。所以，个人计算机中使用的内存需要定期补充电荷，这称为刷新，所以这种存储器也称为**动态随机访问存储器**（Dynamic Random Access Memory，DRAM）。随机访问的意思是，**访问任何一个内存单元的速度和它的位置（地址）无关**。举个例子来说，从头至尾在一盘录音带上找某首歌曲，它越靠前，找到它所花的时间就越短。但内存就不一样，读写地址为0x00001的内存单元，和读写地址为 0xFFFF0 的内存单元，所需要的时间是一样的。

在内存刷新期间，处理器将无法访问它。最麻烦的是，在它断电之后，所有保存的内容都会统统消失。所以，每当处理器加电之后，它无法从内存中取得任何指令。

## 1.3 基本输入输出系统

Intel 8086可以访问 1MB 的内存空间，地址范围为 0x00000 到 0xFFFFF。计算机系统的设计者将这 1MB 的内存空间从物理上分为几个部分。

8086 有 20 根地址线，但并非全都用来访问DRAM。事实上，这些地址线经过分配，大部分用于访问 DRAM，剩余的部分给了只读存储器 ROM 和外围的板卡，如图 4-2 所示。

![config](images/1.png)

与 DRAM 不同，只读存储器（Read Only Memory，ROM）**不需要刷新**，它的内容是**预先写入的**，**掉电也不会消失**，但也很难改变。这个特点很有用，比如，可以将一些程序指令固化在ROM中，使处理器在每次加电时都自动执行。

在以 Intel 8086 为处理器的系统中，ROM占据着整个内存空间顶端的64KB，物理地址范围是 0xF0000～0xFFFFF，里面固化了开机时要执行的指令；DRAM 占据着较低端的 640KB，地址范围是 0x00000～0x9FFFF；中间还有一部分，分给了其他外围设备，这个以后再说。因为8086加电或者复位时，CS=0xFFFF，IP=0x0000，所以，它取的第一条指令位于物理地址0xFFFF0，正好位于 ROM中，那里固化了开机时需要执行的指令。

处理器取指令执行的自然顺序是从内存的低地址往高低地址推进。如果从 0xFFFF0 开始执行，这个位置离1MB内存的顶端（物理地址0xFFFFF）只有16个字节的长度，一旦 IP 寄存器的值超过0x000F，比如IP=0x0011，那么，它与CS一起形成的物理地址将因为溢出而变成 0x00001，这将回绕到 1MB 内存的最低端。

所以，ROM 中位于物理地址 0xFFFF0 的地方，通常是一个跳转指令，它通过改变 CS 和 IP 的内容，使处理器从ROM中的较低地址处开始取指令执行。在NASM汇编语言里，一个典型的跳转指令像这样：

```
jmp 0xf000:0xe05b
```

0xf000 是要跳转到的段地址，用来改变CS寄存器的内容；0xe05b是目标代码段内的偏移地址，用来改变 IP 寄存器的内容。

ROM芯片主要是进行硬件的诊断、检测和初始化。最后，它还负责提供一套软件例程，让人们在不必了解硬件细节的情况下**从外围设备（比如键盘）获取输入数据**，或者**向外围设备（比如显示器）输出数据**。设备很多，所以ROM芯片只针对那些最基本的、对于使用计算机而言最重要的设备，而它所提供的软件例程，也只包含最基本、最常规的功能。正因为如此，这块芯片又叫基本输入输出系统（Base Input & Output System，BIOS）ROM。ROM-BIOS的工作相关知识将会分散在各个章节里讲解。

ROM-BIOS 的容量是有限的，当它完成自己的使命后，最后所要做的，就是从辅助存储设备读取指令数据，然后转到那里开始执行。

## 1.4 硬盘及其工作原理

