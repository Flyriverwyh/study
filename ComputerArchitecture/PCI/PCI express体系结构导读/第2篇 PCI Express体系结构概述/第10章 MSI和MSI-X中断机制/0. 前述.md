在**PCI总线**中，所有需要提交中断请求的设备，必须能够通过**INTx引脚提交中断请求**，而**MSI机制是一个可选机制**。而在**PCIe总线**中，PCIe设备必须**支持MSI或者MSI-X中断请求机制**，而**可以不支持INTx中断消息**。

在PCIe总线中，MSI和MSI-X中断机制使用存储器写请求TLP向处理器提交中断请求，下文为简便起见将传递MSI/MSI-X中断消息的存储器写报文简称为MSI/MSI-X报文。不同的处理器使用了不同的机制处理这些MSI/MSI-X中断请求，如PowerPC处理器使用MPIC中断控制器处理MSI/MSI-X中断请求，本章将在第6.2节中介绍这种处理情况；而x86处理器使用FSB Interrupt Message方式处理MSI/MSI-X中断请求。

不同的处理器对PCIe设备发出的MSI报文的解释并不相同。但是PCIe设备在提交MSI中断请求时，都是**向MSI/MSI-X Capability结构**中的**Message Address的地址写Message Data数据**，从而**组成一个存储器写TLP**，向处理器提交中断请求。

**有些PCIe设备还可以支持Legacy中断方式**（通过发送Assert\_INTx和Deassert\_INTx消息报文进行中断请求，即虚拟中断线方式）。但是PCIe总线并不鼓励其设备使用Legacy中断方式，在绝大多数情况下，PCIe设备使用MSI或者MSI/X方式进行中断请求。

PCIe总线提供Legacy中断方式的主要原因是，在PCIe体系结构中，存在许多PCI设备，而这些设备通过PCIe桥连接到PCIe总线中。**这些PCI设备可能并不支持MSI/MSI-X中断机制**，因此必须使用INTx信号进行中断请求。

**当PCIe桥收到PCI设备的INTx信号后，并不能将其直接转换为MSI/MSI-X中断报文**，因为PCI设备使用INTx信号进行中断请求的机制与电平触发方式类似，而MSI/MSI-X中断机制与边沿触发方式类似。这两种中断触发方式不能直接进行转换。因此当PCI设备的**INTx信号有效**时，**PCIe桥将该信号转换为Assert\_INTx报文**，当这些**INTx信号无效**时，PCIe桥将该信号**转换为Deassert\_INTx报文**。

与Legacy中断方式相比，PCIe设备使用MSI或者MSI-X中断机制，可以消除INTx这个边带信号，而且可以更加合理地处理PCIe总线的“序”。目前绝大多数PCIe设备使用MSI或者MSI-X中断机制提交中断请求。

MSI和MSI-X机制的基本原理相同，其中MSI中断机制最多只能支持32个中断请求，而且要求中断向量连续，而MSI-X中断机制可以支持更多的中断请求，而并不要求中断向量连续。与MSI中断机制相比，MSI-X中断机制更为合理。本章将首先介绍MSI/MSI-X Capability结构，之后分别以PowerPC处理器和x86处理器为例介绍MSI和MSI-X中断机制。