

执行VMXON指令的基本要求是:

* 需要开启`CR4.VMXE`位, 不能在实模式, `virtual-8086`以及兼容模式下进行, 否则将产生`#UD`异常;

* 不能在非0级权限下执行, 否则将产生`#GP`异常.

# IA32_FEATURE_CONTROL 寄存器

`IA32_FEATURE_CONTROL` 寄存器也影响着 VMXON 指令的执行，这个寄存器的 bit0 为 lock 位，bit1 与 bit2 分别是 SMX 模式的 inside 与 outside 位。Inside 位指示允许在 SMX 内使用 VMX, outside 位指示允许在 SMX 外使用 VMX（这是开启 VMX 模式最基本的条件）。

 (1) 当 lock 位为 0 时，执行 VMXON 指令将产生#GP 异常。因此，执行 VMXON 指令前必须确保 lock 位为 1 值，也就是锁上 IA32_FEATURE_CONTROL 寄存器。上锁后如果对 IA32_FEATURE_CONTROL 寄存器进行写操作，将产生 GP 异常。

 (2) Enable VMX inside SMX 位（bit1），指示当处理器处于 SMX (Safer Mode  Extensions）模式时，允许开启 VMX operation 模式。当 inside=0 且处于 SMX 模式时，执行 VMXON 指令将引发 GP 异常。

 (3) Enable VMX outside SMX 位（bit2），指示允许在 SMX 模式之外开启 VMX  operation 模式。当 outside=0 且不在 SMX 模式时，执行 VMXON 指令将引发#GP 异常。

只有支持 VMX 与 SMX 模式时，允许对 bit1 置位（即  CPUID.01H: ECX6:5] -11B）。在支持 VMX 模式时，才允许对 bit2 置位（即

............


