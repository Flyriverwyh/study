

在 VMCS 区域的**三个 VM-execution control 字段**需要检查 VMX 能力寄存器来确认 default0 与 default1 位. 如下所示:

* `Pin-based VM-execution controls` 字段
* `primary processor-based Vm-execution controls` 字段 
* `secondary processor-based Vm-execution controls` 字段

在表 2-2 中列举了这些控制字段所支持的能力由其对应的寄存器提供。当 `IA32_VMX_BASIC[55]` 为 1 时使用 **TRUE 系列寄存器**。此时，
* `pin-based VM-execution control` 字段的值由 `IA32_VMX_TRUE_PINBASED_CTLS` 寄存器来决定设置，
* `primary processor-based VM-execution control` 字段的值由 `IA32_VMX_TRUE_PROCBASED_CTLS` 寄存器来决定设置，
* 但 `secondary processor-based VM-execution control` 字段**没有对应的 TRUE 寄存器**，它只由 `IA32_VMX_PROCBASED_CTLS2` 寄存器来决定设置。

# 1. Pin-based VM-execution control 字段

* 当 `IA32_VMX_BASIC` 的 `bit 55` 为 **0** 时, `IA32_VMX_PINBASED_CTLS`(`481H`) 寄存器决定 `Pin-based VM-execution control` 字段的设置。

* 当 `IA32_VMX_BASIC` 的 `bit 55` 为 **1** 时，忽略 `IA32_VMX_PINBASED_CTLS` 寄存器，由 `IA32_VMX_TRUE_PINBASED_CTLS`(`48DH`) 寄存器来决定设置。

这两个 MSR 的用法是一样的，分为低 32 位与高 32 位。具体用法如下所示

(1) `bits 31:0` (**allowed 0-setting**）：某位为 0 时，`Pin-based VM-execution control` 字段相应的位允许设为 0 值。
(2) `bits 63:32` (**allowed 1-setting**）：某位为 1 时，`Pin-based VM-execution control` 字段相应的位允许设为 1 值。

`Pin-based VM-execution control` 字段属于 **32 位值**，因此 MSR 的高 32 位（**allowed 1-setting**）也是对应 Pin-based VM-execution control 字段的 `bits 31:0`

# 2. primary processor-based VM-execution control 字段

* 当 `IA32_VMX_BASIC` 的 bit 55 为 0 时，`IA32_VMX_PROCBASED_CTLS`(`482H`) 寄存器决定 primary processor-based VM-execution control 字段的设置。

* 当 `IA32_VMX_BASIC` 的 bit 55 为 1 时，忽略 `IA32_VMX_PROCBASED_CTLS` 寄存器，primary processor-based VN-execution control 字段由 `IA32_VMX_TRUE_PROCBASED_CTLS`(`48EH`) 寄存器来决定设置。

这两个 MSR 的用法是一样的，分为低 32 位与高 32 位。具体用法如下所示。

(1) bis 31:0 (allowed 0- setting）：某位为 0 时，primary processor- based VM  execution control 字段相应的位允许设为 0 值。

(2) bis 63:32 (allowed 1- setting）：某位为 1 时，primary processor-based VM-execution control 字段相应的位允许设为 1 值。

primary processor- based VM- execution control 字段也是属于 32 位值，MSR 的高 32 位  allowed- setting）也是对应 primary processor- based VM- execution control 字段的 bis 31:0。

# 3. secondary processor-based VM-execution control 字段

由于 secondary processor-based Vm-execution control 字段**没有对应的 TRUE 寄存器**。因此，它只受到 `IA32_VMX_PROCBASED_CTLS2` 寄存器的影响。

(1) `bits 31:0` (allowed 0-setting）：某位为 0 时，secondary processor- based V  execution control 字段相应的位允许设为 0 值。

(2) `bits 63:32` (allowed 1-setting）：某位为 1 时，secondary processor- based VM-  execution control 字段相应的位允许设为 1 值。

secondary processor- based VM- execution control 字段也是属于 32 位值，高 32 位的  allowed I- -setting 也是对应 secondary processor- based VM- execution control 字段的 bits31:0。