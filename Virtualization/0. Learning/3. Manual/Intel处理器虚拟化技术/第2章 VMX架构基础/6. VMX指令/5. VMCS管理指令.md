

有5条VMX指令涉及VMCS区域的管理. 下面介绍用法.

# 1. VMPTRLD 指令

VMPTRLD 指令从**内存**中加载一个**64位物理地址**作为 `current-VMCS pointer`, 这个 `current-VMCS pointer` 由**处理器内部自动记录和维护**, 除了 **VMXON**、**VMPTRLD** 和 **VMCLEAR** 指令需要提供 **VMXON** 或 **VMCS** 指针作为**操作数**外, **其他的指令**都是在 `current-VMS` 上操作.

```
vmptrld [gs: PCB.GuestA]    ; 加载 64 位VMCS地址
```

注意：这条指令读取的是 **64 位物理地址值**，即使在 **32 位环境**下。如上面代码所示，在 `PCB.GuestA` 里保存着一个 **VMCS 区域**的物理地址值，执行这条指令将更新 `current-VMCS pointer` 值。在指令**未执行成功**时，`current-VMCS pointer` 将维持**原有值**。

处理器会根据提供的 VMCS 指针，进行下面的检查事项：

(1) 物理地址是否超过**物理地址宽度**，并且需要在 **4K 地址边界**上。当 `IA32_VMX_BASIC[48]` 为 1 时，**物理地址宽度**在 **32** 位内，否则为 **MAXPHYADDR** 值（参见第 2.5.4 节）。

(2) VMCS 指针是否为 **VMXON 指针**。

(3) 目标 VMCS 区域**首 DWORD 值**是否符合 `VMCS ID` 值。

当上面检查不通过时，如果原来已经存在 `current-VMCS pointer`，则会产生  **VmfailValid** 失败，`current-vmcs pointer` 将**维持不变**，并且在 current-VMCS 的**指令错误字段**里记录错误号是 **11**（如表 2-5 所示）。指示：“执行 VMPTRLD 时，VMCS 内的  VMCS ID 值不符”。否则，产生 **VmfailInvalid** 失败。

# 2. VMPTRST 指令

# 3. VMCLEAR 指令

# 4. VMREAD 指令

# 5. VMWRITE 指令