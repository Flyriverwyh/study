



```cpp
// arch/x86/include/asm/vmx.h

/*
 * Definitions of Secondary Processor-Based VM-Execution Controls.
 */
#define SECONDARY_EXEC_VIRTUALIZE_APIC_ACCESSES VMCS_CONTROL_BIT(VIRT_APIC_ACCESSES)

```

```cpp
kvm_arch_vcpu_create(); // arch/x86/kvm/x86.c

kvm_vcpu_reset(vcpu, false); // arch/x86/kvm/x86.c

kvm_lapic_reset(vcpu, init_event); // arch/x86/kvm/lapic.c

kvm_lapic_set_base(vcpu, APIC_DEFAULT_PHYS_BASE | MSR_IA32_APICBASE_ENABLE); // arch/x86/kvm/lapic.c

vmx_set_virtual_apic_mode(); // arch/x86/kvm/vmx/vmx.c

```

```cpp

hardware_setup(); // arch/x86/kvm/vmx/vmx.c

setup_vmcs_config(); // arch/x86/kvm/vmx/vmx.c
```