
当“`use TPR shadow`”为 1 时，`virtual-APIC address` 字段有效，需要提供一个物理地址作为 4K 的 **virtual-APIC page** 页面。

virtual-APIC page 是物理平台上 local APIC 的一份 shadow 页面，WMM 可以**初始化**和维护 virtual-APIC page 内的数据。当““virtualize APIC acces 与 use TPR shadow”都为 1 时，使用一个偏移值线性访问 APIC-access page 内的数据，将会访问到 virtual-APIC page 内偏移值相同的数据。也就是：处理器将对 APIC- access page 的访问转化为对  virtual- APIC page 的访问。

在“virtualize x2 APIC mode“为 1 时，软件使用 RDMSR 与 WRMSR 指今来访问

 local APIC，最终也会转化为对 virtual- APIC page 的访问。

在“APIC- registers virtualization“为 1 时，将虚拟化大部分的 local APIC 寄存器（参

见 7.2.5 节及表 7-2)。此时，在 virtual- APIC page 内可以访问到这些虚拟 local APIC 寄存

器，例如 VIRR, VISR 等

3.5.11 TPR threshold 字段

 TPR threshold 字段仅在“use TPR shadow”为 1 时有效。TPR threshold 字段的 bi 3:0 提供一个 VTPR 门坎值，bis31:4 清为 0 值。当写 VPTR 值，而 VPTR [7:4] 值低于  TPR threshold 的 bis3:0 时将产生 Vm-exit

3.5.12 Eoi-exit bitmap 字段

这是一组 64 位宽的字段，共有 4 个 EOl- exit bitmap，分别为

 (1) Eoi-exit bitmap0, 对应向量号从 H 到 3FH

 (2) Eol-exit bitmap，对应向量号从 40H 到 7FH。

 (3) Eoi-exit bitmap2, 对应向量号从 80H 到 BFH。

 (4) EO- exit bitmap3, 对应向量号从 COH 到 FFH

这些字段仅在“virtual- interrupt delivery”为 1 时有效，用于控制发送 EO 命令时是否产生 Vm-exit。当 Eol-exit bitmap 的位为 1 时，对应向量号的中断服务例程在发送 EO 命令时，将产生 VMexit。为 0 时，则进行“虚拟中断的评估及 delivery”，最终的结果可能是另一个虚拟中断被 deliver 执行。