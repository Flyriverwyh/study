Using hypercall to send IPIs by one vmexit instead of one by one for
xAPIC/x2APIC physical mode and one vmexit per-cluster for x2APIC cluster 
mode. Intel guest can enter x2apic cluster mode when interrupt remmaping 
is enabled in qemu, however, latest AMD EPYC still just supports xapic 
mode which can get great improvement by PV IPIs. This patchset supports 
PV IPIs for maximal 128 vCPUs VM, it is big enough for cloud environment 
currently, supporting more vCPUs needs to introduce more complex logic, 
in the future this might be extended if needed.


qemu未模拟interrupt remapping, linux虚机强行使用phys mode的x2apic，导致在flush tlb这样的群发ipi时触发多次vmexit.

阿里的解决方法：修改guest的ipi发送函数，把phys mode下逐个发送ipi转成批量发送ipi（从而成为一种比cluster mode更好的ipi发送方式）从而降低vmexit次数。

我在2016年12月确实也注意到了这个phys mode x2apic的问题，也想了一个解决方案，不过没有对外推。

对他们的这个方案我一方面表示”呵呵”，另一方面还得要承认：虽然我的方案在代码改动量上占优 （只改2行linux代码），他们的方案实现了最大程度的ipi聚合（但实际差距有多大？）