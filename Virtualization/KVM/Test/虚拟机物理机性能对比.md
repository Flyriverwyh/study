
# 确认物理机环境

```
# lscpu
Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                80
On-line CPU(s) list:   0-79
Thread(s) per core:    2
Core(s) per socket:    20
Socket(s):             2
NUMA node(s):          2
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 85
Model name:            Intel(R) Xeon(R) Gold 6148 CPU @ 2.40GHz
Stepping:              4
CPU MHz:               2400.000
BogoMIPS:              4804.71
Virtualization:        VT-x
L1d cache:             32K
L1i cache:             32K
L2 cache:              1024K
L3 cache:              28160K
NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78
NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79
```



* 


* 物理机的native os和虚拟机native os保持一致

物理机

```
# cat /etc/redhat-release
CentOS Linux release 7.2 (Final)
```

虚拟机

```
# cat /etc/redhat-release
CentOS Linux release 7.2.1511 (Core)
```

* 虚拟机和物理机内核重新编译(使用upstream代码), 即两个使用同一个.config文件

编译过程

物理机:

```
# uname -r
3.10.0-693_59

# cp /boot/config-3.10.0-693_59 /data/linux/.config

# make oldconfig
# make all -j80
# make modules_install
# make install
```

编译保证`CONFIG_NO_HZ_IDLE=y`选项

虚拟机同理


# 虚拟机

