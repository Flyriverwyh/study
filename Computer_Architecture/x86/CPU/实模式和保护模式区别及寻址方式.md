
```
转载请注明出处：http://blog.csdn.net/rosetta
```

### 64KB－4GB－64TB？

为什么实模式下最大寻址空间为1MB？

段的最大长度不超过64KB？

而保护模式下为啥最大寻址能力就变成了64TB？每个段最大也达4GB？

分段和分页?

**寻址能力都达64TB**了，为啥我的电脑内存只有2GB呢？这64TB就是所谓的**虚拟地址空间**，也叫**逻辑地址空间**，它能够寻址这么多，只是它有这个能力，并不代表你的内存就要装这么大，你内存比它小再多也不会影响你工作，反过来，要是它的寻址能力只有1MB，而你有2GB的内存，那么那1.999GB就没有实际用处了，这就太浪费资源了。

而实际上这个64TB也没有什么实际意义，因为**32位的地址总线**能寻址的**线性地址空间和物理地址空间**都是2\^32（其实指的是2\^32个地址）=4GB（根据单位为字节算出来的）。这个64TB是怎么出来的，稍后揭晓。

### 实模式与保护模式的来历

最早期的8086 CPU只有一种工作方式，那就是**实模式**，而且**数据总线为 16位**，**地址总线为20位**，实模式下**所有寄存器都是16位**。

而从80286开始就有了保护模式，从80386开始CPU**数据总线和地址总线均为32位**，而且**寄存器都是32位**。

但80386以及现在的奔腾、酷睿等等CPU为了向前兼容都保留了实模式，现代操作系统在刚加电时首先运行在实模式下，然后再切换到保护模式下运行。

### 三种地址

逻辑地址：即逻辑上的地址，**实模式**下由“段基地址+段内偏移”组成；**保护模式**下由“段选择符+段内偏移”组成。

线性地址：逻辑地址经分段机制后就成线性地址，它是平坦的；如果不启用分页，那么此线性地址即物理地址。

物理地址：线性地址经分页转换后就成了物理地址。

### 实模式寻址方式

刚才说了8086 CPU**数据总线**为16位，也就是一次最多能取**2\^16（数值范围是0x0000 ~ 0xFFFF）＝64KB数据**，这个数据也解释了实模式下为什么**每个段最大只有64KB**。但刚才还说了其地址总线为20位，这样它能寻址的能力其实是2^20=1MB，这也就是实模式下CPU的最大寻址能力。既然它有1MB寻址能力，那怎么用16位的段寄存器表示呢？

这就引出了分段的概念，8086 CPU将1MB存储空间分成许多逻辑段，每个段最大限长为64KB（但不一定就是64KB）。这样每个存储单元就可以用“段基地址+段内偏移地址”表示。段基地址由**16位段寄存器值**左移4位表达，段内偏移表示相对于某个段起始位置的偏移量。

比如：

```
SEG=0x07c0
jmpi offset, #SEG
offset: mov ax,cs 
```

### 保护模式寻址方式
    
在定义“逻辑地址”时看到保护模式和实模式的区别在于它是**用段选择符而非段基地址**，这也许就是保护模式的真谛所在，从段选择符入手，全面理解保护模式编程基本概念和寻址方式。