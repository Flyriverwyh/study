- 4.2 保护模式内存管理 
    - 4.2.1 内存寻址
    - 4.2.2 地址变换
    - 4.2.3 保护
    
## 1. 内存寻址

内存是指一组有序字节组成的数组，**每个字节**有唯一的地址。内存寻址指对内存中某个指定数据对象的地址进行定位。这里的数据对象指内存中一个**指定数据类型**的数值或字符串。80x86支持多种数据类型：1字节、2字节（1个字）或4字节（双字或长字）的无符号整型数或有符号整型数，以及多字节字符串等。通常，字节中某一位的定位或寻址可**基于字节来寻址**，因此最小数据类型的寻址是对1字节数据（数值或字符）的定位。通常内存地址从0开始编址，对于80x86 CPU来说，其**地址总线**宽度是32位，因此一共2\^32个不同物理地址，即内存物理地址空间有4GB，总可寻址4GB的物理内存。而对于多字节数据类型（例如2字节整数数据类型），在内存中字节相邻存放。80x86先存放低值字节，随后存放高值字节。因此80x86 CPU是一种先存小值（Little Endian）的处理器。

80x86 CPU，一条指令主要由操作码（Opcode）与操作对象即操作数（Oprand）构成。操作数可以在寄存器中，也可以在内存中。若要定位内存中的操作数，就要进行内存寻址。80x86有许多指令的操作数涉及内存寻址，并针对寻址对象数据类型的不同，由很多不同的寻址方案可供选择。

为了进行内存寻址，80x86使用了一种称为段（Segment）的寻址方式。这种寻址技术把内存空间分成一个或多个称为段的**线性区域**，从而对内存中一个数据对象的寻址就需要使用一个段的起始地址（即段地址）和一个段内偏移地址两部分构成。段地址部分使用16位的段选择符指定，其中**14位**可以选择2\^14即16384个段。**段内偏移地址部分**使用**32位**的值来指定，因此段内地址可以是0 ~ 4GB。即每个段的最大长度可达4GB。程序中由16位的段和32位的偏移构成的48位地址或长指计称为一个逻辑地址（虚拟地址）。它唯一确定了一个数据对象的段地址和段内偏移地址·而仅由32位偏移地址或指针指定的地址是基于当前段的对象地址。
80x86为段部分提供了6个存放段选择符的段寄存器； CS、 DS、 ES、 SS、 FS和 GS。其中 CS总是用于寻址代码段，而堆栈段则专门使用 SS段寄存器。在任何指定时刻由CS寻址的段称为当前代码段。此时 EIP寄存器中包含了当前代码段内下一条要执行指令的段内偏移地址。因此要执行指令的地址可表示成 CS:[EIP]。后面将说明的段间控制转移指令可以被用来为CS
和 EIP赋予新值，从而可以把执行位置改变到其他的代码段中。这样。就实现了在不同段中程序的控制传递。

由段寄存器 SS寻址的段称为当前堆栈段。栈顶由 ESP寄存器内容指定。因此堆栈顶处地址是 SS:[ESP]。另外4个段寄存器是通用段寄存器。当指令中没有指定所操作数据的段时，那么 DS将是默认的数据段寄存器。

为了指定内存操作数的段内偏移地址，80x86指令规定了计算偏移量的很多方式，称为指令寻址方式。指令的偏移量由3部分相加组成：基地址寄存器、变址寄存器和一个偏移常量，三者关系如下：

偏移地址；基地址+（变址×比例因了）+偏移量

## 2. 地址变换