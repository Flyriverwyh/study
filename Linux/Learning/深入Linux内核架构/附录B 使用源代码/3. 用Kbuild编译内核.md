在配置内核之后，就必须编译源代码，来生成内核映像和模块二进制文件。内核使用GNU Make 来完成该工作。它采用了一个复杂的Makefile系统，来满足联编内核的特殊要求，联编普通应用程序 通常没有这些需求。要完全理解该机制的工作原理，就需要对make技巧的深入理解，本附录不打算深 入细节，只是从最终用户和内核程序员的角度(不是Kbuild开发者的角度)，来简单讲述一下联编系 统的使用。Documentation/kbuild/makefiles.txt中包含了联编系统的详细文档，本节就是基于该文档。

# 使用Kbuild系统

联编目标help在内核版本2.5开发期间被引入，用于向用户显示所有可用的make目标。它输出一个目标列表，会区分体系结构相关和无关的目标。例如，在UltraSparc系统上，会显示如下列表:

```
wolfgang@ultrameitner> make help
Cleaning targets:
  clean             - Remove most generated files but keep the config and
                      enough build support to build external modules
  mrproper          - Remove all generated files + config + various backup files
  distclean         - mrproper + remove editor backup and patch files

Configuration targets:
  config            - Update current config utilising a line-oriented program
  menuconfig        - Update current config utilising a menu based program
  xconfig           - Update current config utilising a QT based front-end
  gconfig           - Update current config utilising a GTK based front-end
  oldconfig         - Update current config utilising a provided .config as base
  silentoldconfig   - Same as oldconfig, but quietly
  randconfig        - New config with random answer to all options
  defconfig         - New config with default answer to all options
  allmodconfig      - New config selecting modules when possible
  allyesconfig      - New config where all options are accepted with yes
  allnoconfig       - New config where all options are answered with no

Other generic targets:
  all               - Build all targets marked with [*]
* vmlinux           - Build the bare kernel
* modules           - Build all modules
  modules_install   - Install all modules to INSTALL_MOD_PATH (default: /)
  dir/              - Build all files in dir and below
  dir/file.[ois]    - Build specified target only
  dir/file.ko       - Build module including final link
  rpm               - Build a kernel as an RPM package
  tags/TAGS         - Generate tags file for editors
  cscope            - Generate cscope index
  kernelrelease     - Output the release version string
  kernelversion     - Output the version stored in Makefile
  headers_install   - Install sanitised kernel headers to INSTALL_HDR_PATH
                      (default: /home/wolfgang/linux-2.6.24/usr)
Static analysers
  checkstack        - Generate a list of stack hogs
  namespacecheck    - Name space analysis on compiled kernel
  export_report     - List the usages of all exported symbols
  headers_check     - Sanity check on exported headers

Kernel packaging:
  rpm-pkg           - Build the kernel as an RPM package
  binrpm-pkg        - Build an rpm package containing the compiled kernel
                      and modules
  deb-pkg           - Build the kernel as an deb package
  tar-pkg           - Build the kernel as an uncompressed tarball
  targz-pkg         - Build the kernel as a gzip compressed tarball
  tarbz2-pkg        - Build the kernel as a bzip2 compressed tarball

Documentation targets:
Linux kernel internal documentation in different formats:
  htmldocs          - HTML
  installmandocs    - install man pages generated by mandocs
  mandocs           - man pages
  pdfdocs           - PDF
  psdocs            - Postscript
  xmldocs           - XML DocBook

Architecture specific targets (sparc64):
* vmlinux           - Standard sparc64 kernel
  vmlinux.aout      - a.out kernel for sparc64
  tftpboot.img      - Image prepared for tftp

  make V=0|1 [targets] 0 => quiet build (default), 1 => verbose build
  make V=2 [targets] 2 => give reason for rebuild of target
  make O=dir [targets] Locate all output files in "dir", including .config
  make C=1 [targets] Check all c source with $CHECK (sparse by default)
  make C=2 [targets] Force check of all c source with $CHECK

Execute "make" or "make all" to build all targets marked with [*]
For further info see the ./README file
```

IA\-32和AMD64系统所提供的体系结构相关目标是不同的。

```
wolfgang@meitner> make help
Architecture specific targets (x86):
* bzImage       - Compressed kernel image (arch/x86/boot/bzImage)
  install       - Install kernel using
                    (your) ~/bin/installkernel or
                    (distribution) /sbin/installkernel or
                    install to $(INSTALL_PATH) and run lilo
  bzdisk        - Create a boot floppy in /dev/fd0
  fdimage       - Create a boot floppy image
  isoimage      - Create a boot CD-ROM image
  i386_defconfig        - Build for i386
  x86_64_defconfig      - Build for x86_64
```

如帮助文本所解释的，如果调用make时没有参数，就将编译所有用\*标记的目标。

# Makefile的结构

除了`.config`文件，Kbuild机制还使用了下列组件。

