内核在编译之前必须进行配置。

根据一系列选项，用户可以决定将**哪些函数**包含在**内核**中、**哪些函数**编译为**模块**、哪些函数**排除掉**。

为此，开发者必须提供一个**表明哪些特性可用**的系统。

所以，内核采用了一种称之为**Kconfig的配置语言**，将在本节后面部分讨论。

该配置语言必须解决下列问题。

- 各组件可以持久编译到内核中、可以编译为组件或直接忽略掉(在某些环境下，可能无法将某些组件编译为模块)。
- 在配置选项之间，可能存在相互依赖关系。换言之，某些选项只能与一个或多个其他选项连同使用。
- 必须能够给出一个可用选项列表，供用户从中选择。有些情形，需要提示用户输入编号(或类似的值)。
- 必须能够层次化地编排各种配置选项(在一个树型结构中)。
- 配置选项可能依体系结构而不同。
- 配置语言不应该过于复杂，因为编写配置脚本并非大多数内核程序员喜欢做的事情。 

配置信息应该散布在整个源代码树中，使得没必要维护一个巨型的中枢配置文件，这种巨型配置文件将难于打补丁。在代码包含了可配置选项的每个子目录中，都必须有一个配置文件。下一小节将 用一个例子，来说明配置文件的语法。

# 配置文件示例

配置文件的语法并不特别复杂，如以下取自USB子系统的例子所示(稍作修改):

```config
drivers/usb/Kconfig
#
# USB device configuration
#

menuconfig "USB support"
        bool "USB support"
        depends on HAS_IOMEM
        default y
        ---help---
         This option adds core support for Universal Serial Bus (USB).
         You will also need drivers from the following menu to make use of it.
if USB_SUPPORT

config USB_ARCH_HAS_HCD
        boolean
        default y if USB_ARCH_HAS_OHCI
        ...
        default PCI

config USB_ARCH_HAS_OHCI
        boolean
        # ARM:
        default y if SA1111
        default y if ARCH_OMAP
        # PPC:
        default y if STB03xxx
        default y if PPC_MPC52xx
        # MIPS:
        default y if SOC_AU1X00
        # more:
        default PCI

config USB
        tristate "Support for USB"
        depends on USB_ARCH_HAS_HCD
        ---help---
          Universal Serial Bus (USB) is a specification for a serial bus
          subsystem which offers higher speeds and more features than the
          traditional PC serial port. The bus supplies power to peripherals
          ...

source "drivers/usb/core/Kconfig"
source "drivers/usb/host/Kconfig"
...
source "drivers/usb/net/Kconfig"

comment "USB port drivers"
        depends on USB

config USB_USS720
        tristate "USS720 parport driver"
        depends on USB && PARPORT
        ---help---
          This driver is for USB parallel port adapters that use the Lucent
          Technologies USS-720 chip. These cables are plugged into your USB
          port and provide USB compatibility to peripherals designed with
          parallel port interfaces.
          ...

source "drivers/usb/gadget/Kconfig"

endif # USB_SUPPORT
```

图B\-2说明了如何在屏幕上显示定义的树型结构，使得用户可以选择想要的选项。

图B-2 USB子系统配置结构的屏幕显示:

